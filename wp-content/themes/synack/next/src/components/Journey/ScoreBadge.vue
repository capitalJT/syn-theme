<template>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 25 141 121">
        <defs>
            <!-- rainbow gradient -->
            <linearGradient
                x1="50%"
                y1="0%"
                x2="50%"
                y2="100%"
                id="ars-lineargradient"
            >
                <stop stop-color="#48D895" offset="0%"></stop>
                <stop stop-color="#FFAD39" offset="48%"></stop>
                <stop stop-color="#FF3655" offset="100%"></stop>
            </linearGradient>

            <!-- gradient mask -->
            <mask id="ars-mask">
                <rect x="3" width="125" fill="#fff" y="0" height="140" />
                <rect
                    x="3"
                    width="125"
                    fill="#000"
                    y="35"
                    :height="cmpMaskHeight"
                />
            </mask>
        </defs>

        <path
            d="M30.4708242,97.7751749 L34.0262794,95.7224319 L25.5262794,81 L21.9708068,83.0527531 L1.0125,46.752 C-0.3375,44.414 -0.3375,41.533 1.0125,39.195 L7.0295,28.777 C8.3785,26.44 10.8735,25 13.5725,25 L61,25 L61,29 L78,29 L78,25 L125.0735,25 C127.7735,25 130.2675,26.44 131.6185,28.778 L137.4815,38.936 C138.8315,41.274 138.8315,44.154 137.4815,46.492 L116.293712,83.1903005 L112.5,81 L104,95.7224319 L107.793707,97.9127298 L82.9005,141.029 C81.5515,143.367 79.0555,144.808 76.3565,144.808 L61.9885,144.808 C59.2885,144.808 56.7935,143.367 55.4435,141.029 L30.4708242,97.7751749 Z"
            fill="#535F75"
            opacity="0.229999989"
        ></path>
        <path
            d="M63.7160489,133.120207 L63.7162564,133.120567 C64.0295873,133.664317 64.609347,133.999016 65.2373102,133.999016 L73.6105403,133.999016 C74.2390918,133.999016 74.8180574,133.664674 75.1318095,133.120193 L126.763597,43.6083692 C127.077531,43.0642107 127.077531,42.39326 126.763548,41.8483776 L123.89778,36.8798731 C123.583905,36.3358172 123.004394,36.0009839 122.376473,36.0009839 L16.773675,36.0009839 C16.1466081,36.0009839 15.5667728,36.3360046 15.2524241,36.8797749 L12.236403,42.1089653 C11.9225108,42.6530505 11.9225108,43.3247868 12.2364492,43.8689521 L63.7160489,133.120207 Z"
            stroke="#525f75"
            stroke-width="2.00196775"
            fill="transparent"
        ></path>
        <path
            d="M63.7160489,133.120207 L63.7162564,133.120567 C64.0295873,133.664317 64.609347,133.999016 65.2373102,133.999016 L73.6105403,133.999016 C74.2390918,133.999016 74.8180574,133.664674 75.1318095,133.120193 L126.763597,43.6083692 C127.077531,43.0642107 127.077531,42.39326 126.763548,41.8483776 L123.89778,36.8798731 C123.583905,36.3358172 123.004394,36.0009839 122.376473,36.0009839 L16.773675,36.0009839 C16.1466081,36.0009839 15.5667728,36.3360046 15.2524241,36.8797749 L12.236403,42.1089653 C11.9225108,42.6530505 11.9225108,43.3247868 12.2364492,43.8689521 L63.7160489,133.120207 Z"
            stroke="url(#ars-lineargradient)"
            mask="url(#ars-mask)"
            stroke-width="2.00196775"
            fill="transparent"
        ></path>
        <path
            d="M66.4987552,122.475728 L47.1389058,88.5602513 C46.9536981,88.2358652 46.9536981,87.8357129 47.1389058,87.5113269 L48.2731146,85.5242718 C48.4586987,85.1998858 48.8008812,85 49.1712966,85 L88.8851692,85 C89.255961,85 89.5981435,85.1998858 89.7833512,85.5242718 L90.8610942,87.4123358 C91.0463019,87.7371026 91.0463019,88.1368742 90.8610942,88.4612602 L71.4440262,122.475728 C71.2588185,122.800495 70.916636,123 70.5458442,123 L67.3969372,123 C67.0265218,123 66.6839629,122.800495 66.4987552,122.475728 Z"
            fill="#535F75"
            opacity="0.5"
        ></path>
        <text
            font-family="criquegrotesk"
            font-size="28"
            font-weight="500"
            fill="#FFFFFF"
            text-anchor="middle"
        >
            <tspan x="69" y="70">{{ displayScore }}</tspan>
        </text>
    </svg>
</template>

<script>
import { tween } from 'popmotion'
let inProgress = null

export default {
    computed: {
        arsScore() {
            return this.$store.state.journey.score.ars
        },
        cmpMaskHeight() {
            return 100 - this.displayScore
        }
    },
    data() {
        return {
            displayScore: 0
        }
    },
    mounted() {
        setTimeout(() => this.setDisplayScore(this.arsScore), 1000)
    },
    methods: {
        setDisplayScore(newVal) {
            // stop in-progress tween
            if (inProgress) {
                inProgress.stop()
            }

            // tween the score so the number and mask percentage animate
            inProgress = tween({
                from: this.displayScore,
                to: newVal,
                duration: 1200
            })
                .pipe(Math.floor)
                .start(v => (this.displayScore = v))
        }
    },
    watch: {
        arsScore(newVal) {
            this.setDisplayScore(newVal)
        }
    }
}
</script>
